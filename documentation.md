## History

Before I started this project I had no idea that it would be possible to reproduce Rowling's website, and definitely not on this scale. We had just finished a related project where we tried replicating the WOMBAT experience from the site using some static images and CSS animations. I was looking around online trying to see if I could find more assets from the original site and wondering if it'll be possible to do something similar to what we did with the WOMBATs. It wouldn't be the same, but we could hope to capture some of that nostalgia.

I noticed some old pages on the HP Lexicon that seemed to reference that the Lexicon had at some point hosted not just text copies of the WOMBAT exams (like they do now), but that they used to have actual interactive versions of the exams. A bit more digging through old pages showed me that they were accredited to Roonwit. I had previously contacted Roonwit for his analysis of the WOMBAT scoring system, so I reached out to him to ask for details. 

After some discussion back and forth Roonwit showed me what he had. Between 2004 and 2011 Ronnwit had meticulously saved every file he could find from the site. At the time this was mainly done to track changes. Each filename was appended with the timestamp that the file was from. All in all Roonwit had saved over 3,000 separate files. He also had figured out some ways to get the files to run with limited functionality by combining some of the different dynamic xml response data into single static files. As cool as this was, a lot of the site still didn't work. Over the next five months we worked on identifying which parts of the site that didn't work and writing PHP code to replace the dynamic components, among other things. Some files were still missing but could either be manually recreated from other files or had thankfully been saved on the Wayback Machine.

After we got the main site to work, we tried going further to get the other versions to work. The original website was available in six different languages, a version with accessibility options, and text-only non-flash versions. This is where we encountered the only significant hole in Roonwit's archive. While he had nearly everything necessary for the main site to work, the same wasn't always true with the other versions. However the Wayback Machine had a fairly good copy of all the text-only sites. We were able to download all 1,300 files to implement the text-only versions (after some tweaks) and then using that text we were able to reimplement it back into the flash version, to achieve a near-complete copy of five of the six languages. (The Japanese site never had a text-only version.)

More of as an afterthought, we decided to support some snapshots of how the site looked at different points in time.

## Documentation

Rowling's website worked with a mixture of .swf flash files for the front end, and a coldfusion backend that would deliver .cfm files containing either html or xml data, with the contents determined by the query parameters.

Roonwit figured out early on that if you would combine the nodes from the different versions of an xml response to make one static file, you'd get _most_ parts of the site to function. However, each section of that part of the site would now show the same content. We decided to account for this by using PHP logic to select the data based on the query parameters, similar to how the original site functioned. (Just that while the original was likely pulling from a database, we are directly feeding xml data.) 

We had considered editing the actionscript to pull different files based off of the value before calling it (as in most cases there were less than six possibilities, and could be simply done with a few if/else statements), but the program we were using to edit flash files (JPEXS) doesn't do a perfect job decompliling and recompiling, and some other errors were invariably introduced. We therefore tried to avoid any approaches that required decompiling the AS code, and limited ourselves to simpler things like editing strings when interacting with the flash files.

Another problem is that browsers won't always interpret .cfm files the way we wanted them too. The files that are really html will often be downloaded instead of displayed, and the files that we were replacing with php code won't be interpreted correctly. While we could probably have set up our server to interpret these files differently, we wanted this to be more portable and work on other systems as well with minimal setup. So we renamed all of those file extensions to .html or .php and then edited all the links to them in the actionscript code to match.

A lot of the links were also absolute links, and they all had to be edited to relative urls.

In case of the WOMBATs more work was needed because that file actually has to grade the whole test. Unfortunately, the exact grading scheme was never made public, but we relied on the system Roonwit had made back in 2007 after extensively testing different inputs while the site was still live. The other half of the WOMBATs, the score card, was also tricky. Technically the only use of that on the original site was to look up your marks to the first incarnation of the test, where they weren't returned automatically, but you were given a user code to check them a few days later. What we decided to do was to save the test scores to a cookie, and then have that cookie be read from while looking up your certificate. So you can still get all of that experience, and you can still see the original results.

The Birthdays were done using PHP to check the date and then output the corresponding xml node if it was a character's birthday.

A slightly humorous bug that came up was when we noticed that the rumours tabloid would freeze the site when run from Google Chrome, but seemed to work fine on other browsers. After a lot of frustration it turned out to be that the flash files for the fictional ads on the bottom of the page ("rumour_ad1.swf", etc.) were being blocked by our adblocker. We renamed them (and their links) to remove the word "ad", and they went through.

We then had a functioning version of the website but that wasn't enough. The original site was multilingual so we should be also support those versions. The problem was that Roonwit's archives for the non-English files was severally lacking. Most of the flash files usually contained all the languages as just alternate frames and so were included (except for a few which had separate files per language), but all the xml content wwas have been separate files, and most of it was missing. Thankfully the parts that were missing roughly corresponded to the parts included in the text-only versions of the site, and those had been archived on the WaybackMachine. After a lot of data entry, we had nearly all the languages entered in, with some PHP code to return the correct language. We contacted some fansites to try getting the remaining bits translated, and thus nearly completed those versions. 

The text-only site was easier, as the one on the wayback machine already worked. We downloaded all 1,300 files with a filenameing scheme where we stored each query parameter as a separate file with the "?" as an "_". We then used to regex to strip the WaybackMachineM toolbar, header, and fix the links. We added a bit of javascript to control the birthdays. (We opted to not use any php for the text-only files, because it would be nice to have those completely independent of additional software.

After all of that was finished we thought it would be nice to feature some of the other versions of the site as well. We ultimately decided on using the first date, last date, and the every time the site was decorated for Christmas. This shows off pretty much all the different graphics. We went with a copy dating from just before the last set of site changes as the default version, because that's the best balance of completeness and consistency. As before, we used PHP logic to make sure that the right content was being shown for each version, and to keep the settings consistent throughout the different files we made an editable config file.
